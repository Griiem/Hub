local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Felicity Hub",
   Icon = 0,
   LoadingTitle = "Felicity Hub said hello!",
   LoadingSubtitle = "by Majin/Griiem",
   ShowText = "Felicity",
   Theme = "Ocean",
   ToggleUIKeybind = "H",
   DisableRayfieldPrompts = false,
   DisableBuildWarnings = false,
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "felicity",
      FileName = "FelicityHub"
   },
   Discord = {
      Enabled = true,
      Invite = "Y4br4PhQs2",
      RememberJoins = true
   },
   KeySystem = true,
   KeySettings = {
      Title = "Key System",
      Subtitle = "Key.exe",
      Note = "Join the Discord server to receive the key.",
      FileName = "FelicityH_Key",
      SaveKey = true,
      GrabKeyFromSite = false,
      Key = {"123.png"}
   }
})

-- ///////////////////////
-- MOVEMENT TAB
-- ///////////////////////

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local walkSpeed = 16
local speedEnabled = false

local TabMovement = Window:CreateTab("Movement", 107543713251715)
local SectionMovement = TabMovement:CreateSection("Player Movement")

SectionMovement:CreateToggle({
    Name = "Enable Speed",
    CurrentValue = false,
    Flag = "EnableSpeed",
    Callback = function(Value)
        speedEnabled = Value
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
            LocalPlayer.Character.Humanoid.WalkSpeed = speedEnabled and walkSpeed or 16
        end
    end
})

SectionMovement:CreateInput({
    Name = "WalkSpeed",
    CurrentValue = "16",
    PlaceholderText = "Digite o WS desejado",
    RemoveTextAfterFocusLost = false,
    Callback = function(Text)
        local value = tonumber(Text)
        if value then
            walkSpeed = value
            if speedEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
                LocalPlayer.Character.Humanoid.WalkSpeed = value
            end
        else
            Rayfield:Notify({
                Title = "Erro",
                Content = "Digite um número válido!",
                Duration = 3
            })
        end
    end
})

LocalPlayer.CharacterAdded:Connect(function(char)
    char:WaitForChild("Humanoid")
    if speedEnabled then
        char.Humanoid.WalkSpeed = walkSpeed
    end
end)

-- ///////////////////////
-- ESP TAB
-- ///////////////////////

local TabESP = Window:CreateTab("ESP", 107543713251715)
local SectionESP = TabESP:CreateSection("Player ESP")

local espSettings = {
    name = true,
    box = false,
    health = false,
    distance = false,
    color = Color3.fromRGB(255,255,255)
}

local espGuis = {}

local function createESP(player)
    local char = player.Character or player.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")
    
    local esp = Instance.new("BillboardGui")
    esp.Name = "FelicityESP"
    esp.Parent = char
    esp.Adornee = hrp
    esp.AlwaysOnTop = true
    esp.Size = UDim2.new(0, 200, 0, 50)
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BackgroundTransparency = 1
    frame.BorderSizePixel = 0
    frame.Parent = esp
    
    -- Name
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Text = player.DisplayName
    nameLabel.Size = UDim2.new(1,0,0.5,0)
    nameLabel.Position = UDim2.new(0,0,0,0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Font = Enum.Font.SourceSansBold
    nameLabel.TextSize = 20
    nameLabel.TextColor3 = espSettings.color
    nameLabel.Parent = frame
    nameLabel.Visible = espSettings.name

    -- Box (exemplo simples)
    local box = Instance.new("Frame")
    box.Size = UDim2.new(0,50,0,50)
    box.Position = UDim2.new(0.5,-25,0.5,-25)
    box.BackgroundTransparency = 0.5
    box.BorderSizePixel = 1
    box.BackgroundColor3 = espSettings.color
    box.Parent = frame
    box.Visible = espSettings.box

    -- Aqui você poderia adicionar health/distance

    espGuis[player] = {gui = esp, nameLabel = nameLabel, box = box}
end

local function updateESP(player)
    local guiData = espGuis[player]
    if guiData then
        guiData.nameLabel.Visible = espSettings.name
        guiData.nameLabel.TextColor3 = espSettings.color
        guiData.box.Visible = espSettings.box
        guiData.box.BackgroundColor3 = espSettings.color
        -- Atualiza health/distance se quiser
    end
end

-- Toggle Name
SectionESP:CreateToggle({
    Name = "Show Name",
    CurrentValue = true,
    Flag = "ESP_Name",
    Callback = function(Value)
        espSettings.name = Value
        for player, _ in pairs(espGuis) do
            updateESP(player)
        end
    end
})

-- Toggle Box
SectionESP:CreateToggle({
    Name = "Show Box",
    CurrentValue = false,
    Flag = "ESP_Box",
    Callback = function(Value)
        espSettings.box = Value
        for player, _ in pairs(espGuis) do
            updateESP(player)
        end
    end
})

-- ColorPicker
SectionESP:CreateColorPicker({
    Name = "ESP Color",
    Default = Color3.fromRGB(255,255,255),
    Flag = "ESP_Color",
    Callback = function(Color)
        espSettings.color = Color
        for player, _ in pairs(espGuis) do
            updateESP(player)
        end
    end
})

-- Cria ESP pra todos jogadores atuais
for _, player in ipairs(game.Players:GetPlayers()) do
    if player ~= LocalPlayer then
        createESP(player)
    end
end

-- Quando novo jogador entra
game.Players.PlayerAdded:Connect(function(player)
    createESP(player)
end)
